#!/usr/bin/env python3

#
# Copyright (C) 2024 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-3.0-or-later
#

import agent
import uuid
import subprocess
import os


# Generate the APP_KEY
result = subprocess.run(
        ["podman", "run", "--rm", os.environ["MEETING_2024_APP_IMAGE"], "php", "artisan", "key:generate", "--show"],
    stdout=subprocess.PIPE,
    text=True,
    check=True,
)
app_key = result.stdout.strip()


# Generate the passwords
passwords = {
        # the password for the database is generated by uuid module
        "DB_PASSWORD": str(uuid.uuid4()),
        "MARIADB_ROOT_PASSWORD": str(uuid.uuid4()),
        "APP_KEY": app_key,
}

agent.write_envfile("passwords.env", passwords)
